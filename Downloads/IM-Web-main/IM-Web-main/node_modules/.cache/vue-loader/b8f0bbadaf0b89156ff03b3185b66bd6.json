{"remainingRequest":"C:\\Users\\shenq\\Downloads\\IM-Web-main\\IM-Web-main\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\shenq\\Downloads\\IM-Web-main\\IM-Web-main\\src\\components\\conversation\\conversation-list.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-main\\IM-Web-main\\src\\components\\conversation\\conversation-list.vue","mtime":1650412290000},{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-main\\IM-Web-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650412290000},{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-main\\IM-Web-main\\node_modules\\babel-loader\\lib\\index.js","mtime":1650412290000},{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-main\\IM-Web-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650412290000},{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-main\\IM-Web-main\\node_modules\\vue-loader\\lib\\index.js","mtime":1650412290000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ConversationItem from './conversation-item'\nimport { mapState } from 'vuex'\nimport {getDate, getFullTime} from '@/utils/date'\nexport default {\n  name: 'ConversationList',\n  components: { ConversationItem },\n  data() {\n    return {\n      showDialog: false,\n      userID: '',\n      isCheckouting: false, // 是否正在切换会话\n      timeout: null,\n      helper_list: null,\n      consultantTrueName: '',\n      helperID: '',\n      helperTrueName: '',\n      startTime: '',\n      endTime:'',\n      date:'',\n      helpVisible: this.$store2.state.helpVisible,\n      role: this.$store1.state.role,\n      endDialogVisible: false\n    }\n  },\n  computed: {\n    ...mapState({\n      conversationList: state => state.conversation.conversationList,\n      currentConversation: state => state.conversation.currentConversation\n    })\n  },\n  mounted() {\n    window.addEventListener('keydown', this.handleKeydown)\n    this.getHelperList()\n  },\n  destroyed() {\n    window.removeEventListener('keydown', this.handleKeydown)\n  },\n  methods: {\n    handleRefresh() {\n      this.refreshConversation()()\n    },\n    refreshConversation() {\n      let that = this\n      return function () {\n        if (!that.timeout) {\n          that.timeout = setTimeout(() =>{\n            that.timeout = null\n            that.tim.getConversationList().then(() => {\n              that.$store.commit('showMessage', {\n                message: '刷新成功',\n                type: 'success'\n              })\n            })\n          }, 1000)\n        }\n      }\n    },\n    handleAddButtonClick() {\n      this.showDialog = true\n    },\n    handleEndButtonClick() {\n      this.endDialogVisible = true\n    },\n    getEndTime() {\n      var date = new Date()\n      this.endTime = getFullTime(date)\n    },\n    // getConsultantData() {\n    //   this.$http({\n    //     url: '/admin/getWorkerList',\n    //     method: 'post',\n    //     crossdomain: true,\n    //     body:JSON.stringify({\n    //       'username': this.$store1.state.username,\n    //     })\n    //   }).then(res => {\n    //     // console.log(res.data.data[0].trueName)\n    //     this.consultantTrueName = res.data.data[0].trueName\n    //     this.$store2.commit('setConsultantTrueName',this.consultantTrueName)\n    //     // this.$store2.commit('setConsultantTrueName',res.data.data[0].trueName)\n    //     // console.log(this.$store2.state.consultantTrueName)\n    //   })\n    // },\n    getHelperData() {\n      this.$http({\n        url: '/admin/getWorkerList',\n        method: 'post',\n        crossdomain: true,\n        body:JSON.stringify({\n          'username': this.$store2.state.helperUserName,\n        })\n      }).then(res => {\n        // console.log(res.data.data[0].trueName)\n        this.helperID=res.data.data[0].id\n        this.helperTrueName=res.data.data[0].trueName\n        this.$store2.commit('setHelperID',this.helperID)\n        this.$store2.commit('setHelperTrueName',this.helperTrueName)\n        // console.log(this.$store2.state.helperTrueName)\n        console.log('getHelperInfo')\n      })\n    },\n    handleConfirm() {\n      if (this.userID !== '@TIM#SYSTEM') {\n        this.helpVisible = false\n        this.$store2.commit('setHelpVisible', false)\n        console.log('visible!')\n        // console.log(this.$store2.state.helpVisible)\n        this.$store2.commit('setHelperUserName',this.userID)//helper1\n        console.log(this.$store2.state.helperUserName)\n        this.$store\n            .dispatch('checkoutConversation', `C2C${this.userID}`)\n            .then(() => {\n              this.getTime()\n              // console.log(this.startTime)\n              // console.log(this.$store2.state.helperUserName)\n              // this.getConsultantData()\n              // this.$store2.commit('setConsultantTrueName',this.consultantTrueName)\n              this.getHelperData()\n              // this.$store2.commit('setHelperID',this.helperID)\n              // this.$store2.commit('setHelperTrueName',this.helperTrueName)\n              this.showDialog = false\n            }).catch(() => {\n          this.$store.commit('showMessage', {\n            message: '没有找到该用户',\n            type: 'warning'\n          })\n        })\n      } else {\n        this.$store.commit('showMessage', {\n          message: '没有找到该用户',\n          type: 'warning'\n        })\n      }\n      this.userID = ''\n    },\n    handleEnd() {\n      // console.log('getstartTime success')\n      // console.log(this.$store2.state.date)\n      this.getEndTime()\n      this.$store2.commit('setEndTime',this.endTime)\n\n      console.log(this.endTime)\n      console.log(this.$store1.state.userid)\n      console.log('handleENd')\n      console.log(this.$store2.state.helperID)\n      this.$http({\n        url: '/record/saveRecord',\n        method: 'post',\n        crossdomain: true,\n        headers: {'Content-Type': 'application/json'},\n        body: {\n          'consultantID': this.$store1.state.userid,\n          'helperID': this.$store2.state.helperID,\n          'customerTrueName': '',\n          'consultantTrueName': this.$store1.state.trueName,\n          'helperTrueName': this.$store2.state.helperTrueName,\n          'date': this.$store2.state.date+ ' 00:00:00.000000',\n          'startTime': this.$store2.state.startTime,\n          'endTime': this.$store2.state.endTime,\n          'comment': '',\n          'historyURL': 'url'\n        }\n      }).catch(err => {\n        console.log(err.data)\n      })\n      this.endDialogVisible = false\n      this.helpVisible = true\n      this.$store2.state.helperID=''\n      this.$store2.state.customerTrueName=''\n      this.$store2.state.helperTrueName=''\n      this.$store2.state.startTime=''\n      this.$store2.state.endTime=''\n      this.$store2.state.helpVisible=true\n      // this.$router.push({\n      //   path: '/consultant/frontpage'\n      // })\n    },\n    getHelperList() {\n      this.$http({\n        url: '/admin/getBindWorkerList',\n        method: 'post',\n        crossdomain: true,\n        headers: {'Content-Type': 'application/json'},\n        body:JSON.stringify({\n          'username': this.$store1.state.username\n        })\n      }).then(res => {\n        // console.log(res)\n        console.log('helperlist')\n        this.helper_list=res.data.data\n        console.log(this.helper_list)\n      }).catch(err => {\n        console.log(err.data)\n      })\n    },\n    handleKeydown(event) {\n      if (event.keyCode !== 38 && event.keyCode !== 40 || this.isCheckouting) {\n        return\n      }\n      const currentIndex = this.conversationList.findIndex(\n          item => item.conversationID === this.currentConversation.conversationID\n      )\n      if (event.keyCode === 38 && currentIndex - 1 >= 0) {\n        this.checkoutPrev(currentIndex)\n      }\n      if (\n          event.keyCode === 40 &&\n          currentIndex + 1 < this.conversationList.length\n      ) {\n        this.checkoutNext(currentIndex)\n      }\n    },\n    checkoutPrev(currentIndex) {\n      this.isCheckouting = true\n      this.$store\n          .dispatch(\n              'checkoutConversation',\n              this.conversationList[currentIndex - 1].conversationID\n          )\n          .then(() => {\n            this.isCheckouting = false\n          })\n          .catch(() => {\n            this.isCheckouting = false\n          })\n    },\n    checkoutNext(currentIndex) {\n      this.isCheckouting = true\n      this.$store\n          .dispatch(\n              'checkoutConversation',\n              this.conversationList[currentIndex + 1].conversationID\n          )\n          .then(() => {\n            this.isCheckouting = false\n          })\n          .catch(() => {\n            this.isCheckouting = false\n          })\n    },\n    getTime() {\n      var adate = new Date()\n      this.startTime = getFullTime(adate)\n      this.date = getDate(adate)\n      this.$store2.commit('setStartTime',this.startTime)\n      this.$store2.commit('setDate',this.date)\n    }\n  }\n}\n",{"version":3,"sources":["conversation-list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"conversation-list.vue","sourceRoot":"src/components/conversation","sourcesContent":["<template>\n  <div class=\"list-container\">\n    <div class=\"header-bar\">\n      <button title=\"刷新列表\" @click=\"handleRefresh\">\n        <i class=\"tim-icon-refresh\"></i>\n      </button>\n      <button v-if=\"helpVisible && role==1\" title=\"求助督导\"  @click=\"handleAddButtonClick\">\n        <i class=\"el-icon-notebook-1\"></i>\n      </button>\n      <button v-if=\"!helpVisible && role==1\" title=\"结束求助\"  @click=\"handleEndButtonClick\">\n        <i class=\"el-icon-notebook-1\"></i>\n      </button>\n    </div>\n    <div class=\"scroll-container\">\n      <conversation-item\n          :conversation=\"item\"\n          v-for=\"item in conversationList\"\n          :key=\"item.conversationID\"\n      />\n    </div>\n    <el-dialog title=\"选择求助的督导\" :visible.sync=\"showDialog\" width=\"30%\">\n      <el-select v-model=\"userID\" placeholder=\"请选择求助督导\">\n        <el-option\n            v-for=\"item in helper_list\"\n            :key=\"item.id\"\n            :label=\"item.trueName\"\n            :value=\"item.username\">\n        </el-option>\n      </el-select>\n      <!--      <el-input placeholder=\"请输入用户ID\" v-model=\"userID\" @keydown.enter.native=\"handleConfirm\"/>-->\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"showDialog = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"handleConfirm\">确 定</el-button>\n      </span>\n    </el-dialog>\n    <el-dialog title=\"确认结束督导求助？\" :visible.sync=\"endDialogVisible\" width=\"30%\">\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"endDialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"handleEnd\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport ConversationItem from './conversation-item'\nimport { mapState } from 'vuex'\nimport {getDate, getFullTime} from '@/utils/date'\nexport default {\n  name: 'ConversationList',\n  components: { ConversationItem },\n  data() {\n    return {\n      showDialog: false,\n      userID: '',\n      isCheckouting: false, // 是否正在切换会话\n      timeout: null,\n      helper_list: null,\n      consultantTrueName: '',\n      helperID: '',\n      helperTrueName: '',\n      startTime: '',\n      endTime:'',\n      date:'',\n      helpVisible: this.$store2.state.helpVisible,\n      role: this.$store1.state.role,\n      endDialogVisible: false\n    }\n  },\n  computed: {\n    ...mapState({\n      conversationList: state => state.conversation.conversationList,\n      currentConversation: state => state.conversation.currentConversation\n    })\n  },\n  mounted() {\n    window.addEventListener('keydown', this.handleKeydown)\n    this.getHelperList()\n  },\n  destroyed() {\n    window.removeEventListener('keydown', this.handleKeydown)\n  },\n  methods: {\n    handleRefresh() {\n      this.refreshConversation()()\n    },\n    refreshConversation() {\n      let that = this\n      return function () {\n        if (!that.timeout) {\n          that.timeout = setTimeout(() =>{\n            that.timeout = null\n            that.tim.getConversationList().then(() => {\n              that.$store.commit('showMessage', {\n                message: '刷新成功',\n                type: 'success'\n              })\n            })\n          }, 1000)\n        }\n      }\n    },\n    handleAddButtonClick() {\n      this.showDialog = true\n    },\n    handleEndButtonClick() {\n      this.endDialogVisible = true\n    },\n    getEndTime() {\n      var date = new Date()\n      this.endTime = getFullTime(date)\n    },\n    // getConsultantData() {\n    //   this.$http({\n    //     url: '/admin/getWorkerList',\n    //     method: 'post',\n    //     crossdomain: true,\n    //     body:JSON.stringify({\n    //       'username': this.$store1.state.username,\n    //     })\n    //   }).then(res => {\n    //     // console.log(res.data.data[0].trueName)\n    //     this.consultantTrueName = res.data.data[0].trueName\n    //     this.$store2.commit('setConsultantTrueName',this.consultantTrueName)\n    //     // this.$store2.commit('setConsultantTrueName',res.data.data[0].trueName)\n    //     // console.log(this.$store2.state.consultantTrueName)\n    //   })\n    // },\n    getHelperData() {\n      this.$http({\n        url: '/admin/getWorkerList',\n        method: 'post',\n        crossdomain: true,\n        body:JSON.stringify({\n          'username': this.$store2.state.helperUserName,\n        })\n      }).then(res => {\n        // console.log(res.data.data[0].trueName)\n        this.helperID=res.data.data[0].id\n        this.helperTrueName=res.data.data[0].trueName\n        this.$store2.commit('setHelperID',this.helperID)\n        this.$store2.commit('setHelperTrueName',this.helperTrueName)\n        // console.log(this.$store2.state.helperTrueName)\n        console.log('getHelperInfo')\n      })\n    },\n    handleConfirm() {\n      if (this.userID !== '@TIM#SYSTEM') {\n        this.helpVisible = false\n        this.$store2.commit('setHelpVisible', false)\n        console.log('visible!')\n        // console.log(this.$store2.state.helpVisible)\n        this.$store2.commit('setHelperUserName',this.userID)//helper1\n        console.log(this.$store2.state.helperUserName)\n        this.$store\n            .dispatch('checkoutConversation', `C2C${this.userID}`)\n            .then(() => {\n              this.getTime()\n              // console.log(this.startTime)\n              // console.log(this.$store2.state.helperUserName)\n              // this.getConsultantData()\n              // this.$store2.commit('setConsultantTrueName',this.consultantTrueName)\n              this.getHelperData()\n              // this.$store2.commit('setHelperID',this.helperID)\n              // this.$store2.commit('setHelperTrueName',this.helperTrueName)\n              this.showDialog = false\n            }).catch(() => {\n          this.$store.commit('showMessage', {\n            message: '没有找到该用户',\n            type: 'warning'\n          })\n        })\n      } else {\n        this.$store.commit('showMessage', {\n          message: '没有找到该用户',\n          type: 'warning'\n        })\n      }\n      this.userID = ''\n    },\n    handleEnd() {\n      // console.log('getstartTime success')\n      // console.log(this.$store2.state.date)\n      this.getEndTime()\n      this.$store2.commit('setEndTime',this.endTime)\n\n      console.log(this.endTime)\n      console.log(this.$store1.state.userid)\n      console.log('handleENd')\n      console.log(this.$store2.state.helperID)\n      this.$http({\n        url: '/record/saveRecord',\n        method: 'post',\n        crossdomain: true,\n        headers: {'Content-Type': 'application/json'},\n        body: {\n          'consultantID': this.$store1.state.userid,\n          'helperID': this.$store2.state.helperID,\n          'customerTrueName': '',\n          'consultantTrueName': this.$store1.state.trueName,\n          'helperTrueName': this.$store2.state.helperTrueName,\n          'date': this.$store2.state.date+ ' 00:00:00.000000',\n          'startTime': this.$store2.state.startTime,\n          'endTime': this.$store2.state.endTime,\n          'comment': '',\n          'historyURL': 'url'\n        }\n      }).catch(err => {\n        console.log(err.data)\n      })\n      this.endDialogVisible = false\n      this.helpVisible = true\n      this.$store2.state.helperID=''\n      this.$store2.state.customerTrueName=''\n      this.$store2.state.helperTrueName=''\n      this.$store2.state.startTime=''\n      this.$store2.state.endTime=''\n      this.$store2.state.helpVisible=true\n      // this.$router.push({\n      //   path: '/consultant/frontpage'\n      // })\n    },\n    getHelperList() {\n      this.$http({\n        url: '/admin/getBindWorkerList',\n        method: 'post',\n        crossdomain: true,\n        headers: {'Content-Type': 'application/json'},\n        body:JSON.stringify({\n          'username': this.$store1.state.username\n        })\n      }).then(res => {\n        // console.log(res)\n        console.log('helperlist')\n        this.helper_list=res.data.data\n        console.log(this.helper_list)\n      }).catch(err => {\n        console.log(err.data)\n      })\n    },\n    handleKeydown(event) {\n      if (event.keyCode !== 38 && event.keyCode !== 40 || this.isCheckouting) {\n        return\n      }\n      const currentIndex = this.conversationList.findIndex(\n          item => item.conversationID === this.currentConversation.conversationID\n      )\n      if (event.keyCode === 38 && currentIndex - 1 >= 0) {\n        this.checkoutPrev(currentIndex)\n      }\n      if (\n          event.keyCode === 40 &&\n          currentIndex + 1 < this.conversationList.length\n      ) {\n        this.checkoutNext(currentIndex)\n      }\n    },\n    checkoutPrev(currentIndex) {\n      this.isCheckouting = true\n      this.$store\n          .dispatch(\n              'checkoutConversation',\n              this.conversationList[currentIndex - 1].conversationID\n          )\n          .then(() => {\n            this.isCheckouting = false\n          })\n          .catch(() => {\n            this.isCheckouting = false\n          })\n    },\n    checkoutNext(currentIndex) {\n      this.isCheckouting = true\n      this.$store\n          .dispatch(\n              'checkoutConversation',\n              this.conversationList[currentIndex + 1].conversationID\n          )\n          .then(() => {\n            this.isCheckouting = false\n          })\n          .catch(() => {\n            this.isCheckouting = false\n          })\n    },\n    getTime() {\n      var adate = new Date()\n      this.startTime = getFullTime(adate)\n      this.date = getDate(adate)\n      this.$store2.commit('setStartTime',this.startTime)\n      this.$store2.commit('setDate',this.date)\n    }\n  }\n}\n</script>\n\n<style lang=\"stylus\" scoped>\n.list-container\n  height 100%\n  width 100%\n  display flex\n  flex-direction column // -reverse\n  .header-bar\n    flex-shrink 0\n    height 50px\n    border-bottom 1px solid $background-deep-dark\n    padding 10px 10px 10px 20px\n    button\n      float right\n      display: inline-block;\n      cursor: pointer;\n      background $background-deep-dark\n      border: none\n      color: $font-dark;\n      box-sizing: border-box;\n      transition: .3s;\n      -moz-user-select: none;\n      -webkit-user-select: none;\n      -ms-user-select: none;\n      margin: 0 10px 0 0\n      padding 0\n      width 30px\n      height 30px\n      line-height 34px\n      font-size: 24px;\n      text-align: center;\n      white-space: nowrap;\n      border-radius: 50%\n      outline 0\n      &:hover\n        // background $light-primary\n        // color $white\n        //transform: rotate(360deg);\n        color $light-primary\n  .scroll-container\n    overflow-y scroll\n    flex 1\n.bottom-circle-btn {\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n}\n\n.refresh {\n  bottom: 70px;\n}\n</style>\n"]}]}